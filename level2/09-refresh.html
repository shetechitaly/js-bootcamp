<!DOCTYPE html>
<html>

<head>
  <title></title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
  <script type="text/javascript" src="utils/utils.js"></script>
</head>

<body>
  <button type="button" class="btn btn-secondary" id="refresh-button" style="position: fixed; top: 0; right: 0;">
    <svg class="bi bi-arrow-repeat" width="32" height="32" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
      <path fill-rule="evenodd" d="M6.646 3.646a.5.5 0 01.708 0l6 6a.5.5 0 010 .708l-6 6a.5.5 0 01-.708-.708L12.293 10 6.646 4.354a.5.5 0 010-.708z"/>
    </svg>
  </button> 
  <div class="container">
    <div id="posts"></div>
  <div>
    <hr />
    <form id="post-form">
      <div class="form-group">
        <label for="post-title" class="control-label">Post Title</label>
        <input type="text" class="form-control" id="post-title" placeholder="A new post" minlength="4"/>
      </div>
      <div class="form-group">
        <label for="post-body" class="control-label">Post Content</label>
        <textarea type="text" class="form-control" id="post-body" placeholder="A new Body" minlength="4"></textarea>
      </div>
      <button type="submit" class="btn btn-primary">Post</button>
    </form>
  </div>
</body>
<script>
  function drawElement(post) {
    var postContainer = document.querySelector('#posts');
    postContainer.innerHTML +=
      '<div class="card card-default">' +
        '<div class="card-header">' +
          post.title +
        '</div>' +
        '<div class="card-body">' +
          post.body +
        '</div>' +
      '</div>';
  }

  function refreshMessages() {
    console.log('refresh');
    clearContent();
    fetch(CHAT_URI)
      .then(function(response) {
        return response.json();
      })
      .then(function(posts) {
        toArray(posts).forEach(function(postToAdd) {
          drawElement(postToAdd);
        });
      });
  }

  refreshMessages();

  function clearContent() {
    var postContainer = document.querySelector('#posts');
    postContainer.innerHTML = '';
  }
  
  var form = document.querySelector('#post-form');
  form.onsubmit = function(e) {
    e.preventDefault();
    var titleElement = document.querySelector('#post-title');
    var bodyElement = document.querySelector('#post-body');
    createPost(title, body);
  };

  function createPost(title, body) {
    var postObject = { title: title.value, body: body.value };
    fetch(CHAT_URI, {
      method: "POST",
      body: serialize(postObject)
    });
  }

  var refreshButton = document.querySelector('#refresh-button');
  refreshButton.onclick = function() {
    refreshMessages();
  }
  
</script>
</html>